"""
–†–æ—É—Ç–µ—Ä –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–º–∞–Ω–¥ –±–æ—Ç–∞.
"""

from aiogram import Router, F
from aiogram.filters import Command, StateFilter
from aiogram.types import Message, CallbackQuery, InlineKeyboardMarkup, InlineKeyboardButton
from aiogram.fsm.context import FSMContext
from aiogram.fsm.state import default_state

from .states import GiftSelectionStates, GiftParameters
from .ai_service import ai_service

# –°–æ–∑–¥–∞–µ–º —Ä–æ—É—Ç–µ—Ä –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–º–∞–Ω–¥
router = Router()


@router.message(Command("start"))
async def start_handler(message: Message) -> None:
    """
    –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start.
    
    Args:
        message: –û–±—ä–µ–∫—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    """
    welcome_text = """
        ü§ñ **–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ò–ò-–±–æ—Ç–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –ø–æ–¥–∞—Ä–∫–æ–≤!**

        –Ø –∏—Å–ø–æ–ª—å–∑—É—é –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç –¥–ª—è –ø–æ–¥–±–æ—Ä–∞ –∏–¥–µ–∞–ª—å–Ω—ã—Ö –ø–æ–¥–∞—Ä–∫–æ–≤!

        **–ß—Ç–æ —è —É–º–µ—é:**
        ‚Ä¢ üß† –ò—Å–ø–æ–ª—å–∑—É—é –ò–ò –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
        ‚Ä¢ üéØ –£—á–∏—Ç—ã–≤–∞—é –≤–æ–∑—Ä–∞—Å—Ç, –ø–æ–ª –∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –ø–æ–ª—É—á–∞—Ç–µ–ª—è
        ‚Ä¢ üí∞ –ü—Ä–µ–¥–ª–∞–≥–∞—é –≤–∞—Ä–∏–∞–Ω—Ç—ã –≤ —Ä–∞–º–∫–∞—Ö –≤–∞—à–µ–≥–æ –±—é–¥–∂–µ—Ç–∞
        ‚Ä¢ üéâ –ü–æ–º–æ–≥–∞—é —Å –≤—ã–±–æ—Ä–æ–º –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ø–æ–≤–æ–¥–æ–≤

        **–ù–∞—á–Ω–∏—Ç–µ —Å –∫–æ–º–∞–Ω–¥—ã `/reco` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ò–ò-—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π!**

        –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `/help` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.
    """
    
    await message.answer(welcome_text, parse_mode="Markdown")


@router.message(Command("shop"))
async def shop_handler(message: Message) -> None:
    """
    –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /shop.
    
    –ö–æ–º–∞–Ω–¥–∞ –¥–æ–ª–∂–Ω–∞ –≤—ã–∑—ã–≤–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –º–∞–≥–∞–∑–∏–Ω–∞ –≥–¥–µ –º–æ–∂–Ω–æ –ø—Ä–∏–æ–±—Ä–µ—Å—Ç–∏ –ø–æ–¥–∞—Ä–∫–∏.
    
    Args:
        message: –û–±—ä–µ–∫—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    """
    await message.answer("It's shop command")


@router.message(Command("reco"))
async def reco_handler(message: Message, state: FSMContext) -> None:
    """
    –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /reco.
    
    –ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –≤—ã–±–æ—Ä–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–ª—è –ò–ò-—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π.
    
    Args:
        message: –û–±—ä–µ–∫—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        state: –°–æ—Å—Ç–æ—è–Ω–∏–µ FSM
    """
    await state.set_state(GiftSelectionStates.selecting_gift_type)
    
    # –°–æ–∑–¥–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ –ø–æ–¥–∞—Ä–∫–∞
    keyboard = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text=name, callback_data=f"gift_type_{key}")]
        for key, name in GiftParameters.GIFT_TYPES.items()
    ])
    
    await message.answer(
        "üß† **–ò–ò-–ø–æ–¥–±–æ—Ä –ø–æ–¥–∞—Ä–∫–æ–≤**\n\n"
        "–Ø –∏—Å–ø–æ–ª—å–∑—É—é –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π!\n\n"
        "–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –ø–æ–¥–∞—Ä–∫–∞:",
        reply_markup=keyboard,
        parse_mode="Markdown"
    )
    
@router.message(Command("help"))
async def help_handler(message: Message):
    """
    –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /help
    
    –ö–æ–º–∞–Ω–¥–∞ –¥–æ–ª–∂–Ω–∞ –≤—ã–∑—ã–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–æ—Ç–æ—Ä–æ–µ –¥–æ–ª–∂–Ω–æ –ø–æ–º–æ—á—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è –≤ —Ç–æ–º –∫–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω –±–æ—Ç
    
    Args:
        message: –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    """
    
    help_text = """
            ü§ñ **–ò–ò-–±–æ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π —Ç–µ–ª–µ–≥—Ä–∞–º –ø–æ–¥–∞—Ä–∫–æ–≤**

            **–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:**

            üß† `/reco` - –ü–æ–ª—É—á–∏—Ç—å –ò–ò-—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ–¥–∞—Ä–∫–æ–≤
            ‚Ä¢ –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –ø–æ–¥–∞—Ä–∫–∞ (—ç–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞, –æ–¥–µ–∂–¥–∞, –∫–Ω–∏–≥–∏ –∏ —Ç.–¥.)
            ‚Ä¢ –£–∫–∞–∂–∏—Ç–µ –≤–æ–∑—Ä–∞—Å—Ç –ø–æ–ª—É—á–∞—Ç–µ–ª—è
            ‚Ä¢ –í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª –ø–æ–ª—É—á–∞—Ç–µ–ª—è
            ‚Ä¢ –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –ø–æ–≤–æ–¥ –¥–ª—è –ø–æ–¥–∞—Ä–∫–∞
            ‚Ä¢ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –±—é–¥–∂–µ—Ç
            ‚Ä¢ –ü–æ–ª—É—á–∏—Ç–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –ò–ò-—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏!

            üõçÔ∏è `/shop` - –ü–µ—Ä–µ–π—Ç–∏ –≤ –º–∞–≥–∞–∑–∏–Ω –ø–æ–¥–∞—Ä–∫–æ–≤

            ‚ÑπÔ∏è `/help` - –ü–æ–∫–∞–∑–∞—Ç—å —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ

            **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ò–ò:**
            1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É `/reco`
            2. –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –∏ –≤—ã–±–∏—Ä–∞–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
            3. –ò–ò –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≤–∞—à–∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è
            4. –ü–æ–ª—É—á–∏—Ç–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
            5. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –º–æ–∂–µ—Ç–µ –Ω–∞—á–∞—Ç—å –≤—ã–±–æ—Ä –∑–∞–Ω–æ–≤–æ

            **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –ò–ò-—Å–∏—Å—Ç–µ–º—ã:**
            ‚Ä¢ üß† –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è
            ‚Ä¢ üéØ –£—á–∏—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –≤–∞—à–∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
            ‚Ä¢ üí° –ü—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –∫—Ä–µ–∞—Ç–∏–≤–Ω—ã–µ –∏ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
            ‚Ä¢ üîÑ –ê–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –ø–æ–¥ —Ä–∞–∑–Ω—ã–µ —Å–∏—Ç—É–∞—Ü–∏–∏ –∏ –ø–æ–≤–æ–¥—ã

            –ù–∞—á–Ω–∏—Ç–µ —Å –∫–æ–º–∞–Ω–¥—ã `/reco` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ò–ò-—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π! üöÄ
    """
    
    await message.answer(help_text, parse_mode="Markdown")


